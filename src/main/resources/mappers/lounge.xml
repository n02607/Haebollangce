<?xml version="1.0" encoding="UTF-8"?>
<!-- === mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- === 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="com.sist.haebollangce.common.mapper.InterMapper">

	<!-- // === #2. 게시판 글쓰기 완료 요청 === -->
	<insert id="loungeAdd" parameterType="com.sist.haebollangce.lounge.model.LoungeBoardDTO">
		insert into tbl_lounge_board(seq, fk_userid, name, subject, content, pw, readCount, regDate, status)
		values(lounge_boardSeq.nextval, #{fk_userid}, #{name}, #{subject}, #{content}, #{pw}, default, default, default)
	</insert>

	<!-- // #3-1. 페이징 처리 안한 검색어 없는 전체 글 목록 보기  --> 
	<select id="lgboardListNoSearch" resultType="com.sist.haebollangce.lounge.model.LoungeBoardDTO">
		select seq, fk_userid, name, subject, content, readcount, regdate, commentCount, 
		       TO_DATE(sysdate, 'YYYY-MM-DD') - TO_DATE(regdate, 'YYYY-MM-DD') as regDate_ago, likeCount
		from tbl_lounge_board
		where status = 1
		order by seq desc
	</select>
	
	<!-- // #4-1.글 조회수 증가와 함께 글 1개를 조회 해주는 것 -->
	<select id="lggetView" parameterType="HashMap" resultType="com.sist.haebollangce.lounge.model.LoungeBoardDTO">
		SELECT seq, fk_userid, name, subject, content, readcount, to_char(regdate, 'yyyy-mm-dd hh24:mi:ss') as regdate, pw, commentCount, 
		       regDate_ago, likeCount
		FROM 
		(   
		    select seq, fk_userid, name, subject, content, readcount, regdate, pw, commentCount, 
		           TO_DATE(sysdate, 'YYYY-MM-DD') - TO_DATE(regdate, 'YYYY-MM-DD') as regDate_ago
		    from tbl_lounge_board
		    where status = 1 and seq = #{seq}
		) LB
		CROSS JOIN
		(
		    select count(*) as likeCount
		    from tbl_lounge_like
		    where fk_seq = #{seq}
		) LL
		order by seq desc
	</select>
	
	<!-- // #4-1-1. 글 조회수 1 증가 -->
	<update id="lgsetAddReadCount" parameterType="String">
		update tbl_lounge_board set readcount = readcount + 1
		where seq = #{seq}
	</update>

	<!-- // === #6. 라운지 글 수정 페이지 요청 완료 === -->
	<update id="lgedit" parameterType="com.sist.haebollangce.lounge.model.LoungeBoardDTO">
		update tbl_lounge_board set subject = #{subject} , content = #{content}
		where seq = #{seq} and pw = #{pw}	
	</update>

	<!-- // === #8. 라운지 글 삭제 페이지 요청 완료 === -->
	<delete id="lgdel" parameterType="HashMap">
		delete from tbl_lounge_board 
		where seq = #{seq}	
	</delete>
	

</mapper>